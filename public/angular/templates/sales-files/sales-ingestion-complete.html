<div class="jumbotron" data-pages="parallax">
  <div class="container-fluid container-fixed-lg sm-p-l-20 sm-p-r-20">
    <div class="inner">
      <ul class="breadcrumb">
        <li>
          <p>Curve</p>
        </li>
        <li><a href="/#/sales">Sales</a></li>
        <li ng-show="salesFile._id"><a href="/#/sales/{{salesFile._id}}/complete" class="active">{{salesFile.name}}</a></li>
      </ul>
    </div>
  </div>
</div>
<!-- Main Container -->
<div class="container-fluid container-fixed-lg">
  <div class="row">
    <div class="col-xs-8">
      <h3>{{salesFile.name}}</h3>
      <h5>{{salesFile.salesAccountName}} : {{salesFile.salesTemplateName}}</h5>
    </div>
    <div class="col-xs-4 text-right">
      <a class="btn btn-complete pull-right m-t-10" ng-click="reingest()">Reingest</a>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-3 m-t-40">
      <div class="panel panel-default height-180 bg-primary">
        <div class="panel-heading">
          <div class="panel-title text-white">
            No. of Units
          </div>
        </div>
        <div class="panel-body center bg-primary">
          <h1 class="text-white"><span class="semi-bold">{{salesFile.units || 0}}</span></h1>
          <small>Validation: {{salesFile.validationUnits || 0}}</small>
        </div>
      </div>
    </div>
    <div class="col-xs-3 m-t-40">
      <div class="panel panel-default height-180 bg-complete">
        <div class="panel-heading">
          <div class="panel-title text-white">
            Revenue
          </div>
        </div>
        <div class="panel-body center bg-complete">
          <h1 class="text-white"><span class="semi-bold">£{{salesFile.netAmount | number: 2}}</span></h1>
          <small class="text-white">Validation: £{{salesFile.validationNetAmount | number: 2}}</small>
        </div>
      </div>
    </div>
    <div class="col-xs-3 m-t-40">
      <div class="panel panel-default height-180 bg-info">
        <div class="panel-heading">
          <div class="panel-title text-white">
            No. of Lines
          </div>
        </div>
        <div class="panel-body center bg-info">
          <h1 class="text-white"><span class="semi-bold">{{salesFile.lines || 0}}</span></h1>
          <small class="text-white">Validation: {{salesFile.validationLines || 0}}</small>
        </div>
      </div>
    </div>
    <div class="col-xs-3 m-t-40">
      <div class="panel panel-default height-180" ng-class="{ 'bg-danger': salesFile.invalidLines > 0, 'bg-success': salesFile.invalidLines <= 0 }">
        <div class="panel-heading">
          <div class="panel-title text-white">
            Invalid Lines
          </div>
        </div>
        <div class="panel-body center" ng-class="{ 'bg-danger': salesFile.invalidLines > 0, 'bg-success': salesFile.invalidLines <= 0 }">
          <h1 class="text-white"><span class="semi-bold">{{salesFile.invalidLines || 0}}</span></h1>
        </div>
      </div>
    </div>
  </div>
  <div class="row m-t-40">
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Track Title</label>
        <input type="text" class="form-control" ng-model="filter.trackTitle">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Barcode</label>
        <input type="text" class="form-control" ng-model="filter.barcode">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Distrubution Channel</label>
        <input type="text" class="form-control" ng-model="filter.distributionChannel">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Track Artist</label>
        <input type="text" class="form-control" ng-model="filter.trackArtist">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Cat No.</label>
        <input type="text" class="form-control" ng-model="filter.catNo">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Configuration</label>
        <input type="text" class="form-control" ng-model="filter.configuration">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Album Title</label>
        <input type="text" class="form-control" ng-model="filter.albumTitle">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>ISRC</label>
        <input type="text" class="form-control" ng-model="filter.isrc">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Source</label>
        <input type="text" class="form-control" ng-model="filter.source">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Album Artist</label>
        <input type="text" class="form-control" ng-model="filter.albumArtist">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Territory</label>
        <input type="text" class="form-control" ng-model="filter.territory">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Subsource</label>
        <input type="text" class="form-control" ng-model="filter.subsource">
      </div>
    </div>
    <div class="col-xs-6 col-md-4">
      <div class="form-group required">
        <label>Status</label>
        <ui-select ng-model="filter.status">
          <ui-select-match allow-clear="true">
            <span ng-bind="$select.selected"></span>
          </ui-select-match>
          <ui-select-choices repeat="item in status">
            <span ng-bind="item"></span>
          </ui-select-choices>
        </ui-select>
      </div>
    </div>
  </div>
  <!-- Buttons and Total -->
  <div class="row">
    <div class="col-xs-12 center">
      <button class="btn btn-complete" ng-click="search()"><i class="fa fa-search"></i>&nbsp;Filter</button>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6">
      <button class="btn btn-primary" data-toggle="modal" data-target="#modalEditFields" ng-click="editSelected()">&nbsp;Edit Selected</button>
      <button class="btn btn-success" data-toggle="modal" data-target="#modalEditFields" ng-click="editFiltered()">&nbsp;Edit Filtered</button>
    </div>
    <div class="col-xs-6">
      <h5 class="pull-right">Total: 
        {{total}}
      </h5>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="table-responsive">
            <table class="table table-hover table-condensed dataTable no-footer sales-table sales-table-with-checkbox">
              <thead>
                <tr>
                  <th>
                    <input type="checkbox">
                  </th>
                  <th ng-click="getSortedData('status')" ng-class="whatClassIsIt('status')">Status</th>
                  <th ng-click="getSortedData('catType')" ng-class="whatClassIsIt('catType')">Cat type</th>
                  <th ng-click="getSortedData('distributionChannel')" ng-class="whatClassIsIt('distributionChannel')">Dist Channel</th>
                  <th ng-click="getSortedData('configuration')" ng-class="whatClassIsIt('configuration')">Configuration</th>
                  <th ng-click="getSortedData('priceCategoryreleaseArtist')" ng-class="whatClassIsIt('priceCategoryreleaseArtist')">Price cat</th>
                  <th ng-click="getSortedData('source')" ng-class="whatClassIsIt('source')">Source</th>
                  <th ng-click="getSortedData('source')" ng-class="whatClassIsIt('subSource')">Subsource</th>
                  <th ng-click="getSortedData('territory')" ng-class="whatClassIsIt('territory')">Territory</th>
                  <th ng-click="getSortedData('barcode')" ng-class="whatClassIsIt('barcode')">Barcode</th>
                  <th ng-click="getSortedData('catNo')" ng-class="whatClassIsIt('catNo')">Cat no</th>
                  <th ng-click="getSortedData('isrc')" ng-class="whatClassIsIt('isrc')">ISRC</th>
                  <th ng-click="getSortedData('identifier')" ng-class="whatClassIsIt('identifier')">Identifier</th>
                  <th ng-click="getSortedData('units')" ng-class="whatClassIsIt('units')">Units</th>
                  <th ng-click="getSortedData('originalCurrency')" ng-class="whatClassIsIt('originalCurrency')">Original currency</th>
                  <th ng-click="getSortedData('exchangeRate')" ng-class="whatClassIsIt('exchangeRate')">Ex Rate</th>
                  <th ng-click="getSortedData('salePrice')" ng-class="whatClassIsIt('salePrice')">Sale price</th>
                  <th ng-click="getSortedData('grossAmount')" ng-class="whatClassIsIt('grossAmount')">Gross</th>
                  <th ng-click="getSortedData('netAmount')" ng-class="whatClassIsIt('netAmount')">Net</th>
                  <th ng-click="getSortedData('originalTitle')" ng-class="whatClassIsIt('releaseTitle')">Release title</th>
                  <th ng-click="getSortedData('releaseArtist')" ng-class="whatClassIsIt('releaseArtist')">Release artist</th>
                  <th ng-click="getSortedData('trackArtist')" ng-class="whatClassIsIt('trackArtist')">Track artist</th>
                  <th ng-click="getSortedData('trackTitle')" ng-class="whatClassIsIt('trackTitle')">Track title</th>
                  <th ng-click="getSortedData('saleDate')" ng-class="whatClassIsIt('saleDate')">Sale date</th>
                  <th ng-click="getSortedData('transactionDate')" ng-class="whatClassIsIt('transactionDate')">Transaction date</th>
                  <th ng-click="getSortedData('releaseID')" ng-class="whatClassIsIt('releaseId')">Release id</th>
                  <th ng-click="getSortedData('releaseID')" ng-class="whatClassIsIt('trackId')">Track id</th>
                  <th ng-click="getSortedData('workID')" ng-class="whatClassIsIt('workId')">Work id</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr sales-unmapped-table-row ng-repeat="sale in sales" sale="sale" single="editSingle(sale)"></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade stick-up" id="modalEditFields" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header clearfix text-left">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i>
        </button>
        <h5>Update Fields</h5>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm-6">
            <div class="form-group">
              <label>Cat Type</label>
              <ui-select ng-model="sale.catType">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected"></span>
                </ui-select-match>
                <ui-select-choices repeat="item in catTypes">
                  <span ng-bind="item"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Distribution Channel</label>
              <ui-select ng-model="sale.distributionChannel">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected"></span>
                </ui-select-match>
                <ui-select-choices repeat="item in distributionChannels">
                  <span ng-bind="item"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Configuration</label>
              <ui-select ng-model="sale.configuration">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected"></span>
                </ui-select-match>
                <ui-select-choices repeat="item in configurations">
                  <span ng-bind="item"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Price Category</label>
              <ui-select ng-model="sale.priceCategory">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected"></span>
                </ui-select-match>
                <ui-select-choices repeat="item in priceCategories">
                  <span ng-bind="item"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Source</label>
              <input type="text" class="form-control" ng-model="sale.source">
            </div>
            <div class="form-group">
              <label>Sub Source</label>
              <input type="text" class="form-control" ng-model="sale.subSource">
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label>Currency</label>
              <ui-select ng-model="sale.currency">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected.code"></span>
                </ui-select-match>
                <ui-select-choices repeat="currency.code as currency in currencies | orderBy: 'code'">
                  <span ng-bind-html="currency.code"></span>
                  <span> &nbsp; - &nbsp; </span>
                  <span ng-bind-html="currency.name"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Exchange Rate</label>
              <input type="text" class="form-control" ng-model="sale.exchangeRate">
            </div>
            <div class="form-group">
              <label>Territory</label>
              <ui-select ng-model="sale.territory">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected.name"></span>
                </ui-select-match>
                <ui-select-choices group-by="groupFind" repeat="territory.code as territory in territories">
                  <span class="country" ng-bind="territory.name"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Sale Date</label>
              <div id="datepicker-component" class="form-group input-group date">
                <input type="text" class="form-control" ng-model="sale.saleDate" uib-datepicker-popup="dd/MM/yyyy" is-open="saleDatePopup" ng-click="openSaleDatePopup()">
                <span class="input-group-addon" ng-click="openSaleDatePopup()"><i class="fa fa-calendar"></i></span>
              </div>
            </div>
            <div class="form-group">
              <label>Transaction Date</label>
              <div id="datepicker-component" class="form-group input-group date">
                <input type="text" class="form-control" ng-model="sale.transactionDate" uib-datepicker-popup="dd/MM/yyyy" is-open="transactionDatePopup" ng-click="openTransactionDatePopup()">
                <span class="input-group-addon" ng-click="openTransactionDatePopup()"><i class="fa fa-calendar"></i></span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <hr>
          </div>
          <div class="col-xs-6">
            <div class="form-group">
              <label>Release</label>
              <ui-select ng-model="sale.releaseId">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected.title"></span>
                </ui-select-match>
                <ui-select-choices repeat="item._id as item in releases | filter:$select.search">
                  <span ng-bind="item.title"></span>
                </ui-select-choices>
              </ui-select>
            </div>
          </div>
          <div class="col-xs-6">
            <div class="form-group">
              <label>Track</label>
              <ui-select ng-model="sale.trackId">
                <ui-select-match allow-clear="true">
                  <span ng-bind="$select.selected.title"></span>
                </ui-select-match>
                <ui-select-choices repeat="item._id as item in tracks | filter:$select.search">
                  <span ng-bind="item.title"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="form-group">
              <label>Work</label>
              <ui-select ng-model="sale.workId">
                <ui-select-match>
                  <span ng-bind="$select.selected.title"></span>
                </ui-select-match allow-clear="true">
                <ui-select-choices repeat="item._id as item in works | filter:$select.search">
                  <span ng-bind="item.title"></span>
                </ui-select-choices>
              </ui-select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 m-t-20 text-right">
            <button type="button" class="btn btn-default m-t-5" data-dismiss="modal">Cancel</button>
            <button type="button" ng-if="editType == 'single'" class="btn btn-complete m-t-5" ng-click="updateSingle()"><i class="fa fa-check"></i>&nbsp;Update</button>
            <button type="button" ng-if="editType == 'selected'" class="btn btn-complete m-t-5" ng-click="updateSelected()"><i class="fa fa-check"></i>&nbsp;Update</button>
            <button type="button" ng-if="editType == 'filtered'" class="btn btn-complete m-t-5" ng-click="updateFiltered()"><i class="fa fa-check"></i>&nbsp;Update</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
